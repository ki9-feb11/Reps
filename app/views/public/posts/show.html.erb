<h2><%= @post.title %></h2>

<p><strong>顧客名：</strong> <%= @post.customer.name %></p>
<p><strong>商談内容：</strong><br><%= simple_format(@post.body) %></p>
<p><strong>ステータス：</strong> <%= @post.status_i18n %></p>
<p><strong>商談結果：</strong> <%= @post.result_status_i18n %></p>
<p><strong>顧客の反応：</strong> <%= @post.reaction_i18n %></p>
<p><strong>投稿日時：</strong> <%= l(@post.created_at, format: :short) %></p>

<h4>提案商品一覧</h4>
<table class="table">
  <thead>
    <tr>
      <th>商品名</th>
      <th>数量</th>
    </tr>
  </thead>
  <tbody>
    <% @post.post_products.each do |pp| %>
      <tr>
        <td><%= pp.product.name %></td>
        <td><%= pp.quantity %> 個</td>
      </tr>
    <% end %>
  </tbody>
</table>

<!-- タグ表示 --!>
<p><strong>タグ：</strong>
  <% if @post.tags.any? %>
    <%= @post.tags.map(&:name).join(", ") %>
  <% else %>
    （タグなし）
  <% end %>
</p>

<% if @post.user == current_user %>
  <%= link_to "編集", edit_post_path(@post), class: "btn btn-outline-primary" %>
  <%= link_to "削除", post_path(@post), method: :delete, data: { confirm: "削除しますか？" }, class: "btn btn-danger" %>
<% end %>

<h3>コメント</h3>

<!-- コメント一覧 -->
<div id="comment-list">
  <%= render @post.comments %>
</div>

<!-- コメント投稿フォーム -->
<%= form_with(model: [@post, Comment.new], local: false, data: { turbo: false }) do |f| %>
  <div class="mb-2">
    <%= f.text_area :body, rows: 3, class: "form-control", placeholder: "コメントを入力してください" %>
  </div>
  <%= f.submit "投稿", class: "btn btn-primary" %>
<% end %>

<%= link_to "一覧に戻る", posts_path, class: "btn btn-secondary" %>